<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

	<!--  SakaiProxy -->
 	<bean id="org.sakaiproject.attendance.logic.SakaiProxy"
    	class="org.sakaiproject.attendance.logic.SakaiProxyImpl"
        init-method="init">
        
        <!-- API injection -->
        <property name="securityService" ref="org.sakaiproject.authz.api.SecurityService" />
        <property name="sessionManager" ref="org.sakaiproject.tool.api.SessionManager" />
        <property name="toolManager" ref="org.sakaiproject.tool.api.ToolManager" />
        <property name="userDirectoryService" ref="org.sakaiproject.user.api.UserDirectoryService" />
		<property name="eventTrackingService" ref="org.sakaiproject.event.api.EventTrackingService" />
		<property name="serverConfigurationService" ref="org.sakaiproject.component.api.ServerConfigurationService" />
		<property name="siteService" ref="org.sakaiproject.site.api.SiteService" />
		
	</bean>

    <!-- DAO. This uses the DataSource that has already been setup by Sakai  -->
	<bean id="org.sakaiproject.attendance.dao.AttendanceDaoTarget"
		  class="org.sakaiproject.attendance.dao.impl.AttendanceDaoImpl"
		  init-method="init">
		<property name="sessionFactory" ref="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory" />
	</bean>

	<bean id="org.sakaiproject.attendance.dao.AttendanceDao"
		  class="org.sakaiproject.genericdao.springutil.CurrentClassLoaderTxProxyFactoryBean">
		<property name="transactionManager" ref="org.sakaiproject.springframework.orm.hibernate.GlobalTransactionManager" />
		<property name="target" ref="org.sakaiproject.attendance.dao.AttendanceDaoTarget" />
		<property name="transactionAttributes">
			<props>
				<prop key="*">PROPAGATION_REQUIRED</prop>
			</props>
		</property>
	</bean>

	<!-- AttendanceLogic -->
	<bean id="org.sakaiproject.attendance.logic.AttendanceLogic"
		  class="org.sakaiproject.attendance.logic.AttendanceLogicImpl"
		  init-method="init">

		<property name="dao" ref="org.sakaiproject.attendance.dao.AttendanceDao" />
	</bean>

	<!-- Add our HBM files to the Sakai global session factory -->
	<bean id="org.sakaiproject.attendance.hbm.HBMMappingList"
		  class="org.sakaiproject.springframework.orm.hibernate.impl.AdditionalHibernateMappingsImpl">

		<property name="mappingResources">
			<list>
				<value>org/sakaiproject/attendance/hbm/Event.hbm.xml</value>
			</list>
		</property>

	</bean>

	<!-- Cache: ttl=1 hour -->
	<bean id="org.sakaiproject.attendance.cache.CacheManager"
		  class="org.sakaiproject.attendance.cache.CacheManagerImpl">
		<property name="memoryService" ref="org.sakaiproject.memory.api.MemoryService" />
	</bean>

</beans>
